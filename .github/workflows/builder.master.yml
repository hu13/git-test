
name: Upload artifact to master
on:
  # Trigger the workflow on push or pull request,
  # but only for the master branch
  push:
    branches:
      - master
    paths:
      - '.github/**'
      - '!hello.py'

  pull_request:


jobs:

  build:
    name: Upload merged commit artifacts
    runs-on: ${{ matrix.os }}
    matrix:
      os: [macos-11, windows-latest, ubuntu-latest]

    steps:

    - uses: actions/checkout@v2
      with:
        ref: ${{ github.event.pull_request.head.sha }}

    - name: Get HEAD commit
      run : |
        [[ "${{ github.event_name }}" == "pull_request" ]] && HEAD_COMMIT=${{ github.event.pull_request.head.sha }}
        [[ "${{ github.event_name }}" == "push" ]] && HEAD_COMMIT=${{ github.sha }}
        echo "HEAD_COMMIT=$HEAD_COMMIT" >> $GITHUB_ENV
      shell: bash

    - name: Set up Go 1.17
      uses: actions/setup-go@v2
      with:
        go-version: 1.17

    - name: build upgrade archive
      run: |
        go run main.go
